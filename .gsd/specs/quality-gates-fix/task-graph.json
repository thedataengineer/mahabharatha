{
  "feature": "quality-gates-fix",
  "version": "2.0",
  "generated": "2026-02-03T00:00:00Z",
  "total_tasks": 5,
  "estimated_duration_minutes": 26,
  "max_parallelization": 1,

  "tasks": [
    {
      "id": "L1-001",
      "title": "Configure ruff in pyproject.toml",
      "description": "Update ruff configuration: line-length=120, exclude .mahabharatha and tests/fixtures, select E/F/I/UP rules, fixable=ALL",
      "phase": "foundation",
      "level": 1,
      "dependencies": [],
      "files": {
        "create": [],
        "modify": ["pyproject.toml"],
        "read": []
      },
      "verification": {
        "command": "grep -q 'line-length = 120' pyproject.toml && grep -q 'exclude.*\\.mahabharatha' pyproject.toml",
        "timeout_seconds": 10
      },
      "estimate_minutes": 5,
      "skills_required": ["python", "toml"],
      "consumers": ["L2-001"],
      "integration_test": null,
      "context": "## Spec Context\nR1: Line length 120 chars, exclude .mahabharatha/ and tests/fixtures/, select E/F/I/UP rules.\n\n## Changes Required\n1. Set line-length = 120\n2. Add exclude = [\".mahabharatha\", \"tests/fixtures\"]\n3. Set select = [\"E\", \"F\", \"I\", \"UP\"]\n4. Set fixable = [\"ALL\"]"
    },
    {
      "id": "L2-001",
      "title": "Run ruff auto-fix commands",
      "description": "Run ruff check --fix for safe fixes (443), then ruff check --unsafe-fixes --select F841 for unused variables (90 in test files)",
      "phase": "auto-fix",
      "level": 2,
      "dependencies": ["L1-001"],
      "files": {
        "create": [],
        "modify": ["**/*.py"],
        "read": []
      },
      "verification": {
        "command": "ruff check . 2>&1 | grep -E 'Found [0-9]+ errors' | grep -v 'Found 943'",
        "timeout_seconds": 60
      },
      "estimate_minutes": 2,
      "skills_required": ["python", "bash"],
      "consumers": ["L3-001"],
      "integration_test": null,
      "context": "## Commands to Run\n1. ruff check . --fix\n2. ruff check . --unsafe-fixes --select F841\n3. ruff format .\n\n## Expected Results\n- 443 safe fixes applied\n- 90 F841 unused variable fixes applied\n- Remaining errors should be <100"
    },
    {
      "id": "L3-001",
      "title": "Manual lint fixes",
      "description": "Fix remaining lint errors: E501 >120 chars, E741 ambiguous names, F821 undefined names, other manual fixes",
      "phase": "manual-fix",
      "level": 3,
      "dependencies": ["L2-001"],
      "files": {
        "create": [],
        "modify": ["mahabharatha/**/*.py", "tests/**/*.py"],
        "read": []
      },
      "verification": {
        "command": "ruff check . 2>&1 | grep -q 'Found 0 errors'",
        "timeout_seconds": 30
      },
      "estimate_minutes": 15,
      "skills_required": ["python"],
      "consumers": ["L4-001"],
      "integration_test": null,
      "context": "## Strategy\n1. Run `ruff check .` to see remaining errors\n2. Fix E501 (line too long >120) by wrapping\n3. Fix E741 (ambiguous variable names like 'l') by renaming\n4. Review F821 (undefined name) - potential real bugs\n5. Target: zero errors"
    },
    {
      "id": "L4-001",
      "title": "Create pre-commit configuration",
      "description": "Create .pre-commit-config.yaml with ruff hooks for check --fix and format",
      "phase": "pre-commit",
      "level": 4,
      "dependencies": ["L3-001"],
      "files": {
        "create": [".pre-commit-config.yaml"],
        "modify": [],
        "read": []
      },
      "verification": {
        "command": "test -f .pre-commit-config.yaml && grep -q 'ruff-pre-commit' .pre-commit-config.yaml",
        "timeout_seconds": 10
      },
      "estimate_minutes": 2,
      "skills_required": ["yaml"],
      "consumers": ["L5-001"],
      "integration_test": null,
      "context": "## File Content\n```yaml\nrepos:\n  - repo: https://github.com/astral-sh/ruff-pre-commit\n    rev: v0.4.4\n    hooks:\n      - id: ruff\n        args: [--fix]\n      - id: ruff-format\n```"
    },
    {
      "id": "L5-001",
      "title": "Verify all quality gates pass",
      "description": "Run ruff check, pre-commit hooks, and pytest to ensure everything passes",
      "phase": "verify",
      "level": 5,
      "dependencies": ["L4-001"],
      "files": {
        "create": [],
        "modify": [],
        "read": ["pyproject.toml", ".pre-commit-config.yaml"]
      },
      "verification": {
        "command": "ruff check . && pytest tests/unit/ -x --timeout=30 -q",
        "timeout_seconds": 300
      },
      "estimate_minutes": 2,
      "skills_required": ["python", "testing"],
      "consumers": [],
      "integration_test": null,
      "context": "## Verification Steps\n1. ruff check . → exit 0\n2. pre-commit run --all-files → all hooks pass\n3. pytest tests/unit/ -x → tests pass"
    }
  ],

  "levels": {
    "1": {
      "name": "foundation",
      "tasks": ["L1-001"],
      "parallel": false,
      "estimated_minutes": 5
    },
    "2": {
      "name": "auto-fix",
      "tasks": ["L2-001"],
      "parallel": false,
      "estimated_minutes": 2,
      "depends_on_levels": [1]
    },
    "3": {
      "name": "manual-fix",
      "tasks": ["L3-001"],
      "parallel": false,
      "estimated_minutes": 15,
      "depends_on_levels": [2]
    },
    "4": {
      "name": "pre-commit",
      "tasks": ["L4-001"],
      "parallel": false,
      "estimated_minutes": 2,
      "depends_on_levels": [3]
    },
    "5": {
      "name": "verify",
      "tasks": ["L5-001"],
      "parallel": false,
      "estimated_minutes": 2,
      "depends_on_levels": [4]
    }
  },

  "conflict_matrix": {
    "description": "Tasks that cannot run in parallel due to shared files",
    "conflicts": []
  }
}
