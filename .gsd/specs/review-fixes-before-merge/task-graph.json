{
  "feature": "review-fixes-before-merge",
  "version": "2.0",
  "generated": "2026-02-15T00:00:00Z",
  "total_tasks": 4,
  "estimated_duration_minutes": 8,
  "max_parallelization": 2,

  "tasks": [
    {
      "id": "TASK-001",
      "title": "Fix double sanitization in pr_engine.py",
      "description": "Remove redundant _sanitize_pr_content() call at line 198. Change `message=_sanitize_pr_content(message.strip())` to `message=message.strip()`. Output-boundary sanitization calls at lines 370, 381, 401, 411 remain.",
      "phase": "foundation",
      "level": 1,
      "dependencies": [],
      "files": {
        "create": [],
        "modify": ["zerg/git/pr_engine.py"],
        "read": []
      },
      "verification": {
        "command": "ruff check zerg/git/pr_engine.py",
        "timeout_seconds": 30
      },
      "estimate_minutes": 2,
      "skills_required": ["python"],
      "consumers": ["TASK-003"],
      "integration_test": null,
      "context": "## Security Rules (Python)\n- Sanitize at output boundary, not at parse time (OWASP A05)\n- _sanitize_pr_content() uses html.escape() — safe for XSS prevention\n\n## Spec Context\nFR-001: Remove parse-time _sanitize_pr_content() call at pr_engine.py:198. Keep output-boundary calls at lines 370, 381, 401, 411. Store raw commit messages in CommitInfo.\n\n## Current Code (line 198)\nmessage=_sanitize_pr_content(message.strip()),\n\n## Target Code\nmessage=message.strip(),"
    },
    {
      "id": "TASK-002",
      "title": "Add shlex.quote() to history_engine.py",
      "description": "Add `import shlex` at top of file. Wrap script_path with shlex.quote() at lines 573 and 664: change `f\"python3 {script_path}\"` to `f\"python3 {shlex.quote(script_path)}\"` in both locations.",
      "phase": "foundation",
      "level": 1,
      "dependencies": [],
      "files": {
        "create": [],
        "modify": ["zerg/git/history_engine.py"],
        "read": []
      },
      "verification": {
        "command": "ruff check zerg/git/history_engine.py",
        "timeout_seconds": 30
      },
      "estimate_minutes": 2,
      "skills_required": ["python"],
      "consumers": ["TASK-003"],
      "integration_test": null,
      "context": "## Security Rules (Python)\n- Use shlex.quote() for shell arguments (CWE-78, OWASP A03)\n- subprocess with shell=False is preferred but GIT_SEQUENCE_EDITOR requires shell string\n\n## Spec Context\nFR-002/FR-003: Add shlex.quote() to script_path at history_engine.py:573 and 664. Prevents shell injection if TMPDIR contains spaces.\n\n## Current Code (lines 573, 664)\nenv[\"GIT_SEQUENCE_EDITOR\"] = f\"python3 {script_path}\"\n\n## Target Code\nenv[\"GIT_SEQUENCE_EDITOR\"] = f\"python3 {shlex.quote(script_path)}\"\n\n## Note\nshlex is not currently imported — add `import shlex` at top of file."
    },
    {
      "id": "TASK-003",
      "title": "Run tests and verify CodeQL alerts",
      "description": "Run full test suite: `python -m pytest tests/ --timeout=120`. Run lint: `ruff check zerg/git/pr_engine.py zerg/git/history_engine.py`. Verify FR-004: confirm 0 open CodeQL alerts for cyclic-import and undefined-export rules.",
      "phase": "testing",
      "level": 2,
      "dependencies": ["TASK-001", "TASK-002"],
      "files": {
        "create": [],
        "modify": [],
        "read": ["zerg/git/pr_engine.py", "zerg/git/history_engine.py"]
      },
      "verification": {
        "command": "python -m pytest tests/ --timeout=120 && ruff check zerg/git/pr_engine.py zerg/git/history_engine.py",
        "timeout_seconds": 180
      },
      "estimate_minutes": 3,
      "skills_required": ["python", "testing"],
      "consumers": ["TASK-004"],
      "integration_test": null,
      "context": "## Spec Context\nFR-004: Confirm CodeQL cyclic-import/undefined-export alerts are resolved via `gh api repos/rocklambros/zerg/code-scanning/alerts`.\n\n## Acceptance Criteria\n- python -m pytest tests/ --timeout=120 — green\n- ruff check zerg/git/pr_engine.py zerg/git/history_engine.py — clean\n- CodeQL cyclic-import/undefined-export alerts confirmed at 0"
    },
    {
      "id": "TASK-004",
      "title": "Update CHANGELOG.md",
      "description": "Add entries under [Unreleased] > Fixed for: (1) double-sanitization fix in pr_engine.py, (2) shlex.quote() addition in history_engine.py, (3) CodeQL alert verification confirmed.",
      "phase": "quality",
      "level": 3,
      "dependencies": ["TASK-003"],
      "files": {
        "create": [],
        "modify": ["CHANGELOG.md"],
        "read": []
      },
      "verification": {
        "command": "head -20 CHANGELOG.md",
        "timeout_seconds": 10
      },
      "estimate_minutes": 1,
      "skills_required": [],
      "consumers": [],
      "integration_test": null,
      "context": "## Spec Context\nAdd to [Unreleased] Fixed section:\n- Fixed double-sanitization of PR body content (angle brackets/ampersands rendered correctly)\n- Added shlex.quote() to GIT_SEQUENCE_EDITOR paths for shell safety\n- Verified CodeQL cyclic-import and undefined-export alerts resolved"
    }
  ],

  "levels": {
    "1": {
      "name": "foundation",
      "tasks": ["TASK-001", "TASK-002"],
      "parallel": true,
      "estimated_minutes": 2
    },
    "2": {
      "name": "testing",
      "tasks": ["TASK-003"],
      "parallel": false,
      "estimated_minutes": 3,
      "depends_on_levels": [1]
    },
    "3": {
      "name": "quality",
      "tasks": ["TASK-004"],
      "parallel": false,
      "estimated_minutes": 1,
      "depends_on_levels": [2]
    }
  },

  "conflict_matrix": {
    "description": "Tasks that cannot run in parallel due to shared files",
    "conflicts": []
  }
}
