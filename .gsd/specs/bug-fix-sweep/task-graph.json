{
  "feature": "bug-fix-sweep",
  "version": "2.0",
  "generated": "2026-01-30T12:00:00Z",
  "total_tasks": 3,
  "estimated_duration_minutes": 15,
  "max_parallelization": 3,

  "tasks": [
    {
      "id": "BF-L1-001",
      "title": "Fix StateManager TOCTOU race condition",
      "description": "Hold self._lock for the entire yield duration in _atomic_update() so threads on a shared StateManager are serialized. Move yield inside the with self._lock block and also move _raw_save() inside.",
      "phase": "core",
      "level": 1,
      "dependencies": [],
      "files": {
        "create": [],
        "modify": ["mahabharatha/state.py"],
        "read": ["tests/unit/test_state_extended.py"]
      },
      "acceptance_criteria": [
        "test_concurrent_claims passes",
        "test_concurrent_event_appending passes",
        "All other state tests still pass"
      ],
      "verification": {
        "command": "python -m pytest tests/unit/test_state_extended.py -x --timeout=15 -q",
        "timeout_seconds": 60
      }
    },
    {
      "id": "BF-L1-002",
      "title": "Fix VerificationExecutor dangerous pattern bypass",
      "description": "Change trust_commands=True to trust_commands=False in verify.py _get_executor() so dangerous shell patterns (semicolons, rm -rf, etc.) are always validated even for verification commands.",
      "phase": "core",
      "level": 1,
      "dependencies": [],
      "files": {
        "create": [],
        "modify": ["mahabharatha/verify.py"],
        "read": ["tests/unit/test_verify.py", "mahabharatha/command_executor.py"]
      },
      "acceptance_criteria": [
        "test_verify_invalid_command passes",
        "All other verify tests still pass"
      ],
      "verification": {
        "command": "python -m pytest tests/unit/test_verify.py -x --timeout=15 -q",
        "timeout_seconds": 60
      }
    },
    {
      "id": "BF-L1-003",
      "title": "Fix WorkerProtocol lifecycle tests hanging",
      "description": "Patch claim_next_task on the protocol instance to return None immediately in test_start_sets_running_worker_state and test_start_clean_exit_sets_stopped. This avoids the 120s polling timeout while still testing that start() writes RUNNING and STOPPED worker states.",
      "phase": "testing",
      "level": 1,
      "dependencies": [],
      "files": {
        "create": [],
        "modify": ["tests/unit/test_worker_lifecycle.py"],
        "read": ["mahabharatha/worker_protocol.py"]
      },
      "acceptance_criteria": [
        "test_start_sets_running_worker_state passes within 15s",
        "test_start_clean_exit_sets_stopped passes within 15s",
        "All other worker lifecycle tests still pass"
      ],
      "verification": {
        "command": "python -m pytest tests/unit/test_worker_lifecycle.py -x --timeout=15 -q",
        "timeout_seconds": 60
      }
    }
  ],

  "levels": {
    "1": {
      "name": "all-fixes",
      "tasks": ["BF-L1-001", "BF-L1-002", "BF-L1-003"],
      "parallel": true,
      "estimated_minutes": 5,
      "depends_on_levels": []
    }
  }
}
