# MAHABHARATHA Configuration
# Updated to match MahabharathaConfig schema

project:
  name: mahabharatha
  description: Parallel Claude Code execution system

workers:
  max_concurrent: 5
  timeout_minutes: 60
  retry_attempts: 2
  context_threshold_percent: 70
  launcher_type: subprocess  # Python fallback; task mode is implicit default for /mahabharatha:kurukshetra
  backoff_strategy: exponential
  backoff_base_seconds: 30
  backoff_max_seconds: 300

ports:
  range_start: 49152
  range_end: 65535
  ports_per_worker: 10

quality_gates:
  - name: lint
    command: ruff check .
    required: true
    timeout: 300
  - name: smoke
    command: pytest -m smoke -x --timeout=5 -q
    required: true
    timeout: 60
  - name: test
    command: pytest tests/unit/ -m "not slow" -x --timeout=15 -q --ignore=tests/unit/test_analyze_cmd.py --ignore=tests/unit/test_perf_adapters_coverage.py
    required: true
    timeout: 180
  - name: typecheck
    command: mypy mahabharatha/ --ignore-missing-imports
    required: false
    timeout: 180
  - name: coverage
    command: pytest tests/unit/ --cov=mahabharatha --cov-fail-under=80 -q --timeout=30
    required: false
    timeout: 300
    coverage_threshold: 80
  - name: security
    command: ruff check . --select S
    required: false
    timeout: 60

mcp_servers:
  - filesystem
  - github
  - fetch

resources:
  cpu_cores: 2
  memory_gb: 4
  disk_gb: 10
  container_memory_limit: "4g"
  container_cpu_limit: 2.0

logging:
  level: info
  directory: .mahabharatha/logs
  retain_days: 7

security:
  level: standard
  pre_commit_hooks: true
  audit_logging: true
  container_readonly: true

# Verification gate caching
verification:
  staleness_threshold_seconds: 1800  # 30 min cache (was 300s default)

# Improvement loop settings
improvement_loops:
  enabled: true
  max_iterations: 1  # Single iteration by default (was 5)

# Analysis check configuration
analyze:
  dead_code:
    min_confidence: 80
  wiring:
    strict: false
    exclude_patterns: []
  cross_file:
    scope: "mahabharatha/"
  conventions:
    naming: snake_case
    require_task_prefixes: true
  import_chain:
    max_depth: 10
  context_engineering:
    auto_split: false

# Architecture compliance configuration
# Enforces layer boundaries, import restrictions, and naming conventions
# Runs as a quality gate at ship/merge time
architecture:
  enabled: false  # Enable when ready to enforce architecture rules

  # Layer definitions - imports flow downward
  # layers:
  #   - name: core
  #     paths: ["mahabharatha/config.py", "mahabharatha/constants.py", "mahabharatha/types.py", "mahabharatha/exceptions.py"]
  #     allowed_imports: ["stdlib"]
  #   - name: infrastructure
  #     paths: ["mahabharatha/logging.py", "mahabharatha/ast_cache.py", "mahabharatha/command_executor.py"]
  #     allowed_imports: ["stdlib", "core"]
  #   - name: domain
  #     paths: ["mahabharatha/gates.py", "mahabharatha/launcher.py", "mahabharatha/orchestrator.py"]
  #     allowed_imports: ["stdlib", "core", "infrastructure"]

  # Import allow/deny rules per directory
  import_rules:
    - directory: "mahabharatha/"
      deny: ["flask", "django", "fastapi"]  # No web frameworks in core
    - directory: "tests/"
      allow: ["*"]  # Tests can import anything

  # Naming conventions
  naming_conventions:
    - directory: "mahabharatha/"
      files: "snake_case"
      classes: "PascalCase"
      functions: "snake_case"

  # Exceptions from architecture rules
  exceptions:
    - file: "mahabharatha/__init__.py"
      reason: "Package re-exports need cross-layer access"

# Planning configuration for bite-sized task planning
planning:
  default_detail: standard  # standard|medium|high
  include_code_snippets: false
  include_test_first: true
  step_verification: true
  adaptive_detail: true
  adaptive_familiarity_threshold: 3
  adaptive_success_threshold: 0.8
